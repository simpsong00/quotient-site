---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// If you want, you can set this in astro.config.mjs (recommended):
// site: "https://simpsong00.github.io"
const SITE = import.meta.env.SITE;
---

<BaseLayout title="Blog">
  <section class="mx-auto max-w-4xl px-6 py-12">
    <h1 class="text-4xl font-semibold tracking-tight">Blog</h1>
    <p class="mt-3 text-neutral-700">Updates, research notes, and behind-the-scenes posts.</p>

    <div class="mt-10 space-y-6">
      {posts.map((post) => (
        <article class="rounded-2xl border bg-white/60 p-6">
          <h2 class="text-2xl font-semibold">
            <a class="hover:underline" href={`/blog/${post.slug}/`}>
              {post.data.title}
            </a>
          </h2>

          <div class="mt-2 text-sm text-neutral-600">
            {post.data.pubDate.toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}
          </div>

          {post.data.coverImage ? (
            <img
              class="mt-4 w-full rounded-xl border object-cover"
              src={post.data.coverImage}
              alt=""
              loading="lazy"
            />
          ) : null}

          {post.data.description ? (
            <p class="mt-4 text-neutral-700">{post.data.description}</p>
          ) : null}

          <div class="mt-4">
            <a class="text-accent hover:underline" href={`/blog/${post.slug}/`}>
              Read â†’
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
