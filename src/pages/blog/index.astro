---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const base = import.meta.env.BASE_URL;
// Join base + path safely (works in dev and on /quotient-site/)
const u = (path) => new URL(path.replace(/^\//, ""), base).pathname;

const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout title="Blog" description="The Journey Blog">
  <div class="mx-auto max-w-3xl">
    <h1 class="text-4xl font-semibold tracking-tight">The Journey Blog</h1>
    <p class="mt-3 text-neutral-700">Behind-the-scenes travel, research, locations, and updates from the Quotient universe.</p>

    <div class="mt-8 grid gap-6">
      {posts.map((p) => (
        <a
          class="group block rounded-2xl border border-neutral-200 p-5 hover:bg-accent"
          href={u(`/blog/${p.slug}`)}
        >
          <div class="text-sm text-neutral-600">
            {p.data.pubDate.toLocaleDateString(undefined, { year: "numeric", month: "long", day: "numeric" })}
          </div>
          <div class="mt-2 text-xl font-semibold group-hover:text-accent">{p.data.title}</div>
          {p.data.description ? <p class="mt-2 text-neutral-700">{p.data.description}</p> : null}
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
